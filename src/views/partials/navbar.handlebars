<header class="navbar">
  <div class="container">
    <a href="/" class="logo">
      <img src="/img/logo.png" alt="Hostlee logo" class="logo-img" />
      Hostlee
    </a>

    <nav class="nav-links">
      <a href="/">Inicio</a>
      <a href="/about">Acerca de Nosotros</a>
      <a href="/faq">Preguntas Frecuentes</a>
      <a href="/contact">Contacto</a>
    </nav>

    <div class="nav-actions">

      {{!-- 游댳 1. Si el admin est치 logueado, mostrar su icono y ocultar "Ingresar" --}}
      {{#if isAdmin}}
        <div class="user-menu">
          <div class="user-avatar" id="adminMenuToggle">
            <div class="navbar-initials admin-initials">AM</div>
          </div>

          <div class="user-dropdown" id="adminDropdown">
            <a href="/admin/logout" class="dropdown-item logout">Cerrar sesi칩n</a>
          </div>
        </div>

      {{!-- 游댳 2. Si NO es admin pero hay usuario logueado --}}
      {{else if user}}
        <a href="/api/carts/view" class="cart-icon" title="Carrito de compras">
          <i class="fa-solid fa-house"></i>
          <span class="cart-count">{{cartCount}}</span>
        </a>

        <div class="user-menu">
          <div class="user-avatar" id="userMenuToggle">
            {{#if user.avatar}}
              <img src="{{user.avatar}}" alt="avatar" class="navbar-avatar" />
            {{else}}
              <img
                src="/uploads/avatars/default-avatar.png"
                alt="avatar"
                class="navbar-avatar"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
              />
              <div class="navbar-initials" style="display:none;">
                {{lookup user.first_name 0}}{{lookup user.last_name 0}}
              </div>
            {{/if}}
          </div>

          <div class="user-dropdown" id="userDropdown">
            <a href="/profile" class="dropdown-item">Configurar usuario</a>
            <a href="/api/sessions/logout" class="dropdown-item logout">Cerrar sesi칩n</a>
          </div>
        </div>

      {{!-- 游댳 3. Si no hay usuario ni admin, mostrar bot칩n de login --}}
      {{else}}
        <a href="/login" class="login-button">Ingresar</a>
      {{/if}}

    </div>
  </div>
</header>

<script>
  // --- Toggle para usuario com칰n ---
  const toggle = document.getElementById('userMenuToggle'); 
  const dropdown = document.getElementById('userDropdown'); 
  if (toggle && dropdown) {
    toggle.addEventListener('click', () => { 
      dropdown.classList.toggle('active');
    }); 
    document.addEventListener('click', (e) => {
      if (!toggle.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.classList.remove('active'); 
      } 
    }); 
  }

  // --- Toggle para administrador ---
  const adminToggle = document.getElementById('adminMenuToggle');
  const adminDropdown = document.getElementById('adminDropdown');

  if (adminToggle && adminDropdown) {
    adminToggle.addEventListener('click', () => {
      adminDropdown.classList.toggle('active');
    });

    document.addEventListener('click', (e) => {
      if (!adminToggle.contains(e.target) && !adminDropdown.contains(e.target)) {
        adminDropdown.classList.remove('active');
      }
    });
  }
</script>
